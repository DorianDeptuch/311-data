# Alembic Usage for LA City 311 Data Project

Generic single-database configuration.

## To make new revisions using Alembic

```bash
# from the api directory run Alebmic to generate the revision
alembic revision -m "update views/sp"

# review the migrations in alembic/versions and then apply the upgrade
alembic upgrade head

# remove all the migrations
alembic downgrade base
```

To test Alembic on a test database set the environment variable ```TESTING=True```

## The initial steps to set-up and use Alembic were

1. Initialized Alembic with ```alembic init alembic```
2. Set up DB DSN for Alembic in alembic.ini to ```sqlalchemy.url = postgres://{{username}}:{{password}}@{{address}}/{{db_name}}```
3. Imported the API models in alembic/env.py to ```from lacity_data_api.models import db```
4. Set the target metadata in alembic/env.py to ```target_metadata = db```
5. Ran the initial migration using ```alembic revision -m "first migration" --autogenerate --head head```

Note that the 'metadata' and 'requests' tables are generated by Alembic but are not represented as application models.
